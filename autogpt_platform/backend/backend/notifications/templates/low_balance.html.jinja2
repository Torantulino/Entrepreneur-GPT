{# Low Balance Notification Email Template #}
{# Template variables:
data.current_balance: the current balance of the user
data.threshold_amount: the threshold amount for the notification (usually 0)
data.top_up_link: the link to the top-up page
data.shortfall: the shortfall amount
data.recent_usage: the recent usage history
#}

<p style="
    font-family: 'Poppins', sans-serif;
    color: #070629;
    font-size: 16px;
    line-height: 165%;
    margin-top: 0;
    margin-bottom: 10px;
  ">
  <strong>Insufficient Balance Alert</strong>
</p>

<p style="
    font-family: 'Poppins', sans-serif;
    color: #070629;
    font-size: 16px;
    line-height: 165%;
    margin-top: 0;
    margin-bottom: 20px;
  ">
  Your agent run has been paused due to insufficient balance.
</p>

<div style="
    margin-left: 15px;
    margin-bottom: 20px;
    padding: 15px;
    border-left: 4px solid #5D23BB;
    background-color: #f8f8ff;
  ">
  <p style="
    font-family: 'Poppins', sans-serif;
    color: #070629;
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 10px;
  ">
    <strong>Current Balance:</strong> ${{ "{:.2f}".format((data.current_balance|float)/100) }}
  </p>
  <p style="
    font-family: 'Poppins', sans-serif;
    color: #070629;
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 10px;
  ">
    <strong>Threshold Amount:</strong> ${{ "{:.2f}".format((data.threshold_amount|float)/100) }}
  </p>
  <p style="
    font-family: 'Poppins', sans-serif;
    color: #070629;
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 10px;
  ">
    <strong>Shortfall:</strong> ${{ "{:.2f}".format((data.shortfall|float)/100) }}
  </p>
</div>


<div style="
    margin-left: 15px;
    margin-bottom: 20px;
    padding: 15px;
    border-left: 4px solid #FF6B6B;
    background-color: #FFF0F0;
  ">
  <p style="
    font-family: 'Poppins', sans-serif;
    color: #070629;
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 10px;
  ">
    <strong>Transaction Details:</strong>
  </p>
  <p style="
    font-family: 'Poppins', sans-serif;
    color: #070629;
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 5px;
  ">
    Your agent run requires additional credits to complete.
  </p>
</div>

{% if data.recent_usage and data.recent_usage|length > 0 %}
<div style="
    margin-bottom: 20px;
  ">
  <p style="
    font-family: 'Poppins', sans-serif;
    color: #070629;
    font-weight: 600;
    font-size: 16px;
    margin-bottom: 10px;
  ">
    Recent Usage:
  </p>

  <div style="
      margin-left: 15px;
      background-color: #f5f5ff;
      padding: 12px;
      border-radius: 4px;
      font-family: 'Roboto Mono', monospace;
      white-space: pre-wrap;
      word-break: break-word;
      overflow-wrap: break-word;
      max-width: 100%;
      overflow-x: auto;
    ">
    {% for usage in data.recent_usage %}
      <p style="margin: 5px 0;">
        {{ usage.date }} - {{ usage.agent_name }}: ${{ "{:.2f}".format((usage.credits_used|float)/100) }}
      </p>
    {% endfor %}
  </div>
</div>
{% endif %}

<div style="
    text-align: center;
    margin: 30px 0;
  ">
  <a href="{{ data.top_up_link }}" style="
    font-family: 'Poppins', sans-serif;
    background-color: #5D23BB;
    color: white;
    padding: 12px 24px;
    text-decoration: none;
    border-radius: 4px;
    font-weight: 500;
    display: inline-block;
  ">
    Top Up Balance
  </a>
</div>

<p style="
    font-family: 'Poppins', sans-serif;
    color: #070629;
    font-size: 14px;
    line-height: 150%;
    margin-top: 30px;
    margin-bottom: 10px;
    font-style: italic;
  ">
  This is an automated notification. Your agent will resume running after you top up your balance.
</p>